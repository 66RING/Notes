---
title: 2022暑期实习面试小结
author: 66RING
date: 2000-01-01
mathjax: true
---

# Abstract

面试公司：阿里，字节，PingCAP

总结：大失败

sum: 面试官对面试的节奏的掌握也参差不齐，一个问题如果卡死了，后续都没能展现太亏了。应该将主动权掌握在自己手里：主动要提示，主动提出bypass。就像考试，先把能拿的分拿到手。面试就是讨价还价，你抬价，他出题难你压价。


# 字节

- 操作系统的零拷贝技术
	* TODO
- 手写LRU
	* 翻车：我应该先问清楚应用场景的，**或者我应该主动说**: 那我们得具体问题具体分析，就假设如下场景吧: balabala(自己熟悉的场景)
		+ 然后面试官就了LRU的get, put操作，然后我并不知道put有什么用。put就是set嘛，咳
	* 场景：分桶buffer cache
		1. 一个buffer的blockid相同，那么我们可以复用这个buffer(LRU从头到refcnt==0的节点)，移链首，然后返回
		2. 如果没有可以复用的buffer，那就找一个空的(refcnt==0)然后分配，移链首，返回
		3. 如果还是没有找到，因为是分桶的，从其他桶里找(从尾到头找)，找到后偷到当前链的链首
- raft
	* raft基本机制
	* raft防止脑裂的方法: args.Term > Term { becomefollower() }
	* raft节点数量有什么限制
		+ 奇数个：防止网络分区时两个分区都无法选出leader
- 网络相关：
	* 都了解什么协议
		+ 我：TCP，http
	* TCP怎么保证可靠
		+ 我：超时重传
		+ 其实是多方面的，是思考题啦。比如checksum，滑动窗口buffer等都直接间接保证
	* TCP所在层
		+ 传输层
	* TCP和UDP区别
- IO多路复用：poll, epoll, select区别
	* [my blog](https://github.com/66ring/Notes/tree/master/universe/tech_tips/IO_multiplexing_intro.md)
	
- sum: 提问时间我应该问一下


# 阿里

阿里云自治服务(DAS)

## 一面

官：殷征

- 你的死锁检测脚本
	* 我先说明使用背景
		1. 直接debug go比较困难，很多很多goroutine，很多很多thread
		2. 而且，go对thread， goroutine这些又封装得厉害，`backtrace`看半天看不出个所以然
		3. 以防万一我都是直接"两段锁协议"的，基本不会出现交叉锁的情况(但是没考虑循环锁)
		4. 而且我不想用网上现成的死锁检测库破坏原本的项目结构
		5. 所以我面临的最主要文件是channel导致的死锁
		6. 然后我的脚本帮我发现了好几个corner case
	* 本质就是根据log判断，一进`>>>`要期待一出`<<<`，如果长时间没有响应，直接接收，然出输出没有得到响应的进`>>>`
- raft, paxos了解情况
- **了解僵尸进程吗**，怎么消除僵尸进程
	* 一个进程结束，但父进程没有`wait/waitpid`，那它将变为僵尸进程
	* 可以`ps`命令查看
- 用过哪些数据库
- cpu占用热点排查
- 你做的项目都由什么感觉，分享一下
- 平衡树, b, b+等
- 布隆过滤器
- 数据库索引了解多少
- docker镜像过大该怎么处理
	* 压缩，拆分
	* 精简镜像尺寸的好处
		+ 减小构造时间
		+ 减少磁盘使用量
		+ 减少下载时间
		+ 文件少，攻击面小，提高安全性
		+ 提供部署速度
	* 方法
		1. 优化基础镜像：如，可以在Ubuntu、CentOs、Alpine中选择Alpine
			- 再如`scratch镜像`, `busybox`镜像等
		2. 串联dockerfile指令：`cmd && cmd`
			- 使用太多RUN会导致镜像很多层，甚至超出上限127层 
		3. 多阶段构建
		4. 构建业务服务镜像技巧
		5. 压缩镜像


## 二面

- 深造就业的打算
	* 大失败，我应该说我相信主观能动性的
- 了解分布式锁吗，应该考虑什么
	* TODO
	* 分布式锁需要考虑很多网络失效又恢复的情况, 怎么抽象呢
	* 死锁
	* 二次释放
	* 等...
- 分布式协议的应用场景
	* 怎么有效，安全地组织节点
- 了解数据库实现吗
	* 我说了笛卡尔积这样数学的，但是忘了说索引，大失败
	* 其实还可以说OLAP，OLTP，HTAP的考虑，可惜都忘了，大失败
- 很和蔼，但是感觉问得都很锋利hhh
	* 我知道感觉在哪了，我感觉这些问题是能突击出来的，但我却不知道，所以

大失败，只面试了45分钟，G

总结：其实有很多懂的可以说，但是感觉干干问一下子想不起来，**下次可以多主动要点提示**。真的是太多细节一下子想不到

挂了


# PingCap

## round 1

> 面试前一天进公司鱼塘了... 可能复核简历时刷了哈哈(55555)。
> 
> 结果是搞乌龙了，我是改面另一个部门，所以原来的部门当然就挂了

官：俞平

面了90分钟(好累, 复盘时都想不起什么了)。问了很多我简历上的(QEMU)，体验满分，因为问的都是设计上的问题，不是八股文。

- 为什么PingCap
	* 开源与开源爱好者
	* 分享
	* 远见
- 根据我讲的QEMU一个一个问
	* 线程模型，为什么是事件驱动 TODO
	* QOM
	* 模拟流程
- c++如何实现多态
- 怎么看待设计模式
- c/cpp中如何防止内存泄露等问题
	* 我的答案是没有好办法，是我从rust中反推出的
		+ 然后开始问我rust了555
		+ 事后我想到也许可以使用静态分析工具
			+ 然后idea就来了，既然rust的通过编译器的大量检测实现的，那么静态分析工具是否可以在编写时检测，这样就不会向rust编译那般耗时了
	* 其实可以`unique_ptr`等。cpp里面很多也是有自动管理生命思想的，`shared_ptr`
	* 网上的答案
		+ 尽量使用只能指针而不是手动管理
		+ `std::string`内部做好了内存管理而不像`char*`
			+ 说这样可能就会被问string内部如何实现的😑
		+ 尽量避免在堆上分配内存
		+ 用户自定义的类型最好使用引用传参
		+ 在类的构造函数与析构函数中匹配的调用new和delete
		+ 在释放对象数组时，使用delete []
- rust如何获取多个可变引用
	* TOOD
- tcp如何保证可靠传输
- 大数据了解情况: e.g. mapreduce
	* 布隆过滤器
		+ 小 fit in memory
		+ O(1)
		+ 小心误判，必要时布隆过滤器只做预判，过滤不存在
		+ 多哈希防止误判
- rockDB
	* 我不知道然后给他回了我了解的B+树

TODO

编程题简单，但是我没写对。求二叉搜索树第三大的节点。


大失败!!!!!


## round 2

- 二叉树z形输出
	* 可以用标准库我没有，bug一堆
	* 指针问题，标准库容器应该使用`iterator`
- 布尔运算表达式树优化
	* 预处理 => log(N)
	* 如何log(1)
		+ 因为是bool，所以结果是0,1。输入也是0,1，完全可以用bitmap简单地将输入输出对应起来
	* 可恶，就差一点

- tidb下一个方向
	* 往云迁移
	* htap

我的东西都没问，问了算1h结束，**G**

sum: 

- 一个思维题(算法优化题)拖太久了，不会应该直接说，然后尽可能输出更多自己熟悉的内容。
- 标准库没用，也不太会用
	* 如何使用指针获取到标准库里(e.g. vector)的内容
		+ 迭代器：`auto it = a.begin()`, 这样it就相当于c里的指针了`it++ = p++`
- 指针忘了取地址`&`


# 腾讯云

## round 1

腾讯云的话方向是非常非常对口的，包括虚拟化，操作系统方面。

SDN

bypass:
sddk
ddk

管理qemu: openstack

容器层面

- 从下到上: 虚拟机的管理，虚拟机中容易的管理
- bypass
- 软件定义网络SDN

TODO

- 问了"linux进程创建到销毁的流程"
- linux下都有哪些调度策略
- fork后进程是不是独立了
	* 我拉了，我没反映过来，觉得父子没有COW还在share就不是独立。但是其实因为会COW，所以即使shared也是不会相互影响的，所以是独立的。
	* 其实从pid分配开始(或者更前)就是独立的了
- fork后什么是一样的，什么是不一样的
- 因为我拉了，所以他问了我"什么的进程"
	* 我说进程就是状态机，各个寄存器的内容就是他的状态。二进制文件就是状态机的profile
- 几种page fault
	* TODO 两种：主page fault(和硬盘换出)? 另一个是虚拟内存内


还当场给了评价"大概懂，但是具体细节不懂"，挺贴心了。

## round 2

- 问了linux内存管理, slab分配器, buddy system
- 问了很多qemu
	* 遇到了哪些问题，报什么错，还遇到了哪些问题(我忘了遇到什么具体的问题了，一下子答不上来
		+ 启动时报错无法挂载文件系统(block size)
		+ 找不到设备(mpic)
		+ 内核编译参数
			+ 开启支持QEMU generic e500 platform等
			+ initrd支持
			+ 核心支持(processor support)问题，导致启动qemu时使用的`-cpu`不同
		+ dtb文件定义顺序，初始cpu
		+ qemu中需要`qemu_fdt_dumpdtb`才能导出dtb文件
		+ 兼容性不标签和image的对应
		+ 加载内核，内核启动参数，pc寄存器位置，qemu monitor
		+ dtb指定输出设备`qemu_fdt_setprop_string(fdt, "/chosen", "stdout-path", "/serial@0xXXXXX");`
- 然后就是pushdown
	* ftrace, strace, systemtab


## round 3

问了一些平时都没考虑到的东西。

- 内核太中的如何知道用户态寄存器信息的
- 进程怎么知道内核栈的状态
	* 微机原理，就是x86 中断时保存现场
	* riscv中有专门的寄存器
- 很多什么时候创建问题
- 内核态里怎么分配内存
	* kmalloc
	* vmalloc
- 用户态malloc除了brk系统调用还有什么
- 中断机制
	* 一下子没想起来，可惜
	* 中断向量，中断号
- 锁
	* 一下子没反映过来，直接聊理论了，不太好
	* 其实可以有死锁，自旋锁，读写锁等


# 华为

就两面，只有其中一个是技术面。



# 总结

- 面试写代码可以来点`assertion`
- 我面试真的太随便了，想到啥说啥，语速快逻辑性也没组织好。
- 我的学习路线太容易随大流了，什么都感兴趣，什么都学了一点但不精通。咳咳咳
- 大失败





